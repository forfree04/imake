<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>imake - ë§¤ì¥ ìƒì„¸ ì •ë³´</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; margin: 0; background: #f5f5f5; }
        .store-img { width: 100%; height: 250px; background: #ddd; object-fit: cover; }
        .content { padding: 20px; background: #fff; border-radius: 20px -20px 0 0; margin-top: -20px; position: relative; }
        /* ì‹ í˜¸ë“± ìƒíƒœ í‘œì‹œ */
        .status-badge { display: inline-block; padding: 5px 12px; border-radius: 15px; font-size: 12px; color: #fff; margin-bottom: 10px; }
        .status-green { background: #28a745; } /* ë°”ë¡œ ì…ì¥ */
        
        .discount-card { background: #fff3cd; border: 1px dashed #ffeeba; padding: 15px; border-radius: 10px; margin: 15px 0; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-outline { background: #fff; border: 1px solid #007bff; color: #007bff; }
    </style>
</head>
<body>
    <div class="store-img" id="storeImage">ì´ë¯¸ì§€ ì˜ì—­</div>

    <div class="content">
        <div id="status" class="status-badge status-green">â— ë°”ë¡œ ì…ì¥ ê°€ëŠ¥</div>
        <h2 id="storeName">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2>
        <p id="storeDesc">ë§¤ì¥ ì„¤ëª…ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</p>

        <div class="discount-card">
            <strong>ğŸ imake ë©¤ë²„ì‹­ í˜œíƒ</strong>
            <p>ì´ ë§¤ì¥ì—ì„œ ê²°ì œ ì‹œ 10% í• ì¸ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <div class="btn-group">
            <button class="btn btn-primary" id="open-app-btn">ì•±ì—ì„œ ì—´ê¸°</button>
            <button class="btn btn-outline" onclick="location.href='/'">ì›¹ìœ¼ë¡œ ê³„ì† ë³´ê¸°</button>
        </div>
    </div>

    // ê³µê¸‰ì ì™¸ë¶€ qrí´ë¦­ì‹œ ë‚˜ì˜¤ëŠ” í˜ì´ì§€. ë§¤ì¥ ì •ë³´ì™€ í˜¼ì¡ë„ ìƒíƒœë¥¼ í‘œì‹œ
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAonpP6itJ9_vMlAQm-0oC-fqmhlYMReE4", authDomain: "imake-master.firebaseapp.com", projectId: "imake-master", storageBucket: "imake-master.firebasestorage.app", messagingSenderId: "612892096078", appId: "1:612892096078:web:5a573c1a0dceb525eaf51f" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const urlParams = new URLSearchParams(window.location.search);
        const storeId = urlParams.get('id');

        if (storeId) {
            loadStoreData(storeId);
        } else {
            document.getElementById('storeName').innerText = "ë§¤ì¥ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        }

        async function loadStoreData(id) {
            try {
                // recommendations ì»¬ë ‰ì…˜(ë§¤ì¥ ì •ë³´)ì—ì„œ ì¡°íšŒ
                const docRef = doc(db, "recommendations", id);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    
                    document.getElementById('storeName').innerText = data.title;
                    document.getElementById('storeDesc').innerText = data.desc || "";
                    
                    if (data.img) {
                        const imgEl = document.getElementById('storeImage');
                        imgEl.style.backgroundImage = `url('${data.img}')`;
                        imgEl.style.backgroundSize = 'cover';
                        imgEl.innerText = '';
                    }

                    // í˜¼ì¡ë„ ìƒíƒœ ë°˜ì˜
                    const statusEl = document.getElementById('status');
                    const statusMap = { 'green': 'â— ì—¬ìœ ', 'yellow': 'â— ë³´í†µ', 'red': 'â— í˜¼ì¡' };
                    const colorMap = { 'green': '#22c55e', 'yellow': '#eab308', 'red': '#ef4444' };
                    
                    if (data.status && statusMap[data.status]) {
                        statusEl.innerText = statusMap[data.status];
                        statusEl.style.backgroundColor = colorMap[data.status];
                    }
                } else {
                    document.getElementById('storeName').innerText = "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë§¤ì¥ì…ë‹ˆë‹¤.";
                }
            } catch (e) {
                console.error(e);
            }
        }

        // [ì‹ ê·œ] ì•± ì—´ê¸° ë²„íŠ¼ ë¡œì§ (ë”¥ë§í¬)
        const openAppBtn = document.getElementById('open-app-btn');
        if (openAppBtn) {
            openAppBtn.addEventListener('click', () => {
                // 1. ë”¥ë§í¬ URL ì •ì˜ (ì‹¤ì œ ì•± ê°œë°œ ì‹œ í˜‘ì˜ëœ ìŠ¤í‚´ ì‚¬ìš©)
                // ì˜ˆ: imake://spot?id=ë§¤ì¥ID
                const deepLink = `imake://spot?id=${storeId}`;

                // 2. ì•±ìŠ¤í† ì–´/í”Œë ˆì´ìŠ¤í† ì–´ URL (ì‹¤ì œ IDì™€ íŒ¨í‚¤ì§€ëª…ìœ¼ë¡œ êµì²´ í•„ìš”)
                const AppStoreID = '123456789'; // ì˜ˆì‹œ: ì‹¤ì œ ì•±ì˜ Apple ID
                const AndroidPackageName = 'com.imake.app'; // ì˜ˆì‹œ: ì‹¤ì œ ì•±ì˜ íŒ¨í‚¤ì§€ëª…

                const appStoreUrl = `https://apps.apple.com/app/id${AppStoreID}`;
                const playStoreUrl = `https://play.google.com/store/apps/details?id=${AndroidPackageName}`;

                const ua = navigator.userAgent.toLowerCase();
                const isAndroid = ua.includes('android');
                const isIOS = /iphone|ipad|ipod/.test(ua);

                // 3. PC ë˜ëŠ” ë¯¸ì§€ì› OSì¼ ê²½ìš°
                if (!isAndroid && !isIOS) {
                    alert('ì´ ê¸°ëŠ¥ì€ ëª¨ë°”ì¼ ì•±ì—ì„œë§Œ ì§€ì›ë©ë‹ˆë‹¤.');
                    return;
                }

                // 4. ë”¥ë§í¬ ì‹œë„ (ì»¤ìŠ¤í…€ ìŠ¤í‚´ ë°©ì‹)
                // ì°¸ê³ : Universal Link/App Linkê°€ ì„¤ì •ë˜ì–´ ìˆë‹¤ë©´ ê·¸ ì£¼ì†Œë¡œ ë°”ë¡œ ì´ë™í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ìŠµë‹ˆë‹¤.
                window.location.href = deepLink;

                // 5. ì•±ì´ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ìŠ¤í† ì–´ë¡œ ë¦¬ë””ë ‰ì…˜
                setTimeout(() => {
                    // ì•±ìœ¼ë¡œ ì„±ê³µì ìœ¼ë¡œ ì „í™˜ë˜ì—ˆë‹¤ë©´ í˜ì´ì§€ê°€ ë°±ê·¸ë¼ìš´ë“œë¡œ ì „í™˜ë˜ì–´ ì•„ë˜ ì½”ë“œê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
                    if (document.hidden) return; 
                    if (isIOS) window.location.href = appStoreUrl;
                    else if (isAndroid) window.location.href = playStoreUrl;
                }, 2500); // 2.5ì´ˆ í›„ ì‹¤í–‰
            });
        }
    </script>
</body>
</html>