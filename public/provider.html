<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒŒíŠ¸ë„ˆ ëŒ€ì‹œë³´ë“œ - imake</title>
    <link rel="stylesheet" href="https://unpkg.com/lucide@latest">
    <style>
        body { font-family: 'Pretendard', sans-serif; margin: 0; background: #f8fafc; color: #333; }
        .admin-container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .login-box { max-width: 400px; margin: 100px auto; background: white; padding: 40px; border-radius: 16px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .dashboard { display: none; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-success { background: #10b981; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        input { padding: 8px; border: 1px solid #ddd; border-radius: 6px; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
    </style>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div id="login-view" class="login-box">
        <h2>íŒŒíŠ¸ë„ˆ ë¡œê·¸ì¸</h2>
        <p>ì œíœ´ ì—…ì²´ ì‚¬ì¥ë‹˜ ë¡œê·¸ì¸</p>
        <button class="btn btn-primary" onclick="providerLogin()">êµ¬ê¸€ ë¡œê·¸ì¸</button>
    </div>

    <!-- ê°€ì… ì‹ ì²­ í™”ë©´ -->
    <div id="register-view" class="login-box" style="display:none;">
        <h2>íŒŒíŠ¸ë„ˆ ê°€ì… ì‹ ì²­</h2>
        <p>ê°€ê²Œ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ê°€ì…ì„ ì‹ ì²­í•˜ì„¸ìš”.</p>
        <input type="text" id="reg-store-name" placeholder="ì—…ì²´ëª… (Store Name)">
        <input type="text" id="reg-email" placeholder="Email" disabled style="background:#eee;">
        <button class="btn btn-success" onclick="registerProvider()" style="width:100%; margin-top:10px;">ê°€ì… ì‹ ì²­</button>
    </div>

    <!-- ìŠ¹ì¸ ëŒ€ê¸° í™”ë©´ -->
    <div id="pending-view" class="login-box" style="display:none;">
        <h2 style="color:#f59e0b;">â³ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘</h2>
        <p>ê´€ë¦¬ì ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.<br>ìŠ¹ì¸ì´ ì™„ë£Œë˜ë©´ ëŒ€ì‹œë³´ë“œê°€ í™œì„±í™”ë©ë‹ˆë‹¤.</p>
        <button class="btn" onclick="providerLogout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>

    <div id="dashboard-view" class="admin-container dashboard">
        <div class="header">
            <h2>ğŸª ë‚´ ë§¤ì¥ ëŒ€ì‹œë³´ë“œ</h2>
            <button class="btn btn-danger" onclick="providerLogout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
        
        <div style="margin-bottom:20px; border-bottom:1px solid #ddd; display:flex; gap:10px;">
            <button onclick="switchTab('dashboard')" id="btn-tab-dash" class="btn" style="background:none; color:#333; border-bottom:2px solid #3b82f6; border-radius:0;">ëŒ€ì‹œë³´ë“œ</button>
            <button onclick="switchTab('settings')" id="btn-tab-set" class="btn" style="background:none; color:#333; border-radius:0;">ì„¤ì •</button>
        </div>

        <div id="tab-dashboard" class="card-grid">
            <!-- [ì‹ ê·œ] í˜¼ì¡ë„ ê´€ë¦¬ (ì‹ í˜¸ë“±) -->
            <div class="card" style="border: 2px solid #10b981; grid-column: 1 / -1;">
                <h3 style="color:#10b981; margin-top:0;">ğŸš¦ ë§¤ì¥ í˜¼ì¡ë„ ê´€ë¦¬</h3>
                <p style="color:#666; font-size:14px; margin-bottom:15px;">í˜„ì¬ ë§¤ì¥ì˜ í˜¼ì¡ë„ë¥¼ ì„¤ì •í•˜ì„¸ìš”. ì‚¬ìš©ì ì•± ì¶”ì²œ ë¦¬ìŠ¤íŠ¸ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.</p>
                <div style="display:flex; gap:10px;">
                    <button onclick="updateCongestion('green')" class="btn-congestion" id="btn-green" style="flex:1; padding:15px; border:1px solid #ddd; border-radius:8px; background:white; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:5px; transition:0.2s;">
                        <div style="width:24px; height:24px; border-radius:50%; background:#10b981;"></div>
                        <span style="font-weight:bold; color:#333;">ì—¬ìœ  (Green)</span>
                    </button>
                    <button onclick="updateCongestion('yellow')" class="btn-congestion" id="btn-yellow" style="flex:1; padding:15px; border:1px solid #ddd; border-radius:8px; background:white; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:5px; transition:0.2s;">
                        <div style="width:24px; height:24px; border-radius:50%; background:#f59e0b;"></div>
                        <span style="font-weight:bold; color:#333;">ë³´í†µ (Yellow)</span>
                    </button>
                    <button onclick="updateCongestion('red')" class="btn-congestion" id="btn-red" style="flex:1; padding:15px; border:1px solid #ddd; border-radius:8px; background:white; cursor:pointer; display:flex; flex-direction:column; align-items:center; gap:5px; transition:0.2s;">
                        <div style="width:24px; height:24px; border-radius:50%; background:#ef4444;"></div>
                        <span style="font-weight:bold; color:#333;">í˜¼ì¡ (Red)</span>
                    </button>
                </div>
            </div>

            <!-- [í•µì‹¬] ì‹¤ì‹œê°„ ì£¼ë¬¸ ì ‘ìˆ˜ (KDS) -->
            <div class="card" style="border: 2px solid #3b82f6;">
                <h3 style="color:#3b82f6;">âš¡ ì‹¤ì‹œê°„ ì£¼ë¬¸ ì ‘ìˆ˜ (Live Orders)</h3>
                <div id="live-order-list" style="min-height: 200px; background:#f0f9ff; border-radius:8px; padding:10px; margin-bottom:20px;">
                    <p style="text-align:center; color:#888; margin-top:20px;">ëŒ€ê¸° ì¤‘ì¸ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
                <h4>ì™„ë£Œëœ ì£¼ë¬¸</h4>
                <div id="history-list" style="max-height: 200px; overflow-y: auto;">Loading...</div>
            </div>

            <!-- ë©”ë‰´ ê´€ë¦¬ -->
            <div class="card">
                <h3>ë©”ë‰´ ê´€ë¦¬</h3>
                <div id="menu-list">Loading...</div>
                <div style="margin-top: 20px; border-top: 1px solid #eee; padding-top: 20px;">
                    <h4>ë©”ë‰´ ì¶”ê°€/ìˆ˜ì •</h4>
                    <input type="hidden" id="menu-id">
                    <input type="text" id="menu-name-ko" placeholder="ë©”ë‰´ëª… (Korean)">
                    <input type="text" id="menu-name-en" placeholder="ë©”ë‰´ëª… (ì˜ì–´)">
                    <input type="number" id="menu-price" placeholder="ê°€ê²© (ì›)">
                    <input type="text" id="menu-img" placeholder="ì´ë¯¸ì§€ URL">
                    <button class="btn btn-success" onclick="saveMenu()">ë©”ë‰´ ì €ì¥</button>
                    <button class="btn" onclick="clearMenuForm()">ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>

        <div id="tab-settings" style="display:none;">
            <div class="card" style="max-width:600px;">
                <h3>ë§¤ì¥ ì„¤ì •</h3>
                <div id="pending-msg" style="display:none; background:#fff3cd; color:#856404; padding:10px; border-radius:6px; margin-bottom:15px; border:1px solid #ffeeba;">
                    â³ ìˆ˜ì • ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤. (ê´€ë¦¬ì í™•ì¸ í›„ ë°˜ì˜ë©ë‹ˆë‹¤)
                </div>
                <label style="display:block; margin-top:15px; font-weight:bold;">ì—…ì²´ëª…</label>
                <input type="text" id="set-store-name">
                
                <label style="display:block; margin-top:10px; font-weight:bold;">ì˜ì—… ì‹œê°„</label>
                <input type="text" id="set-store-hours" placeholder="ì˜ˆ: 10:00 - 22:00">

                <label style="display:block; margin-top:10px; font-weight:bold;">ì¹´í…Œê³ ë¦¬</label>
                <select id="set-store-cat" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px; margin-bottom:20px;">
                    <option value="Food">Food (ë§›ì§‘)</option>
                    <option value="Cafe">Cafe (ì¹´í˜)</option>
                    <option value="Activity">Activity (ì•¡í‹°ë¹„í‹°)</option>
                </select>

                <button class="btn btn-primary" onclick="saveStoreSettings()">ë³€ê²½ì‚¬í•­ ì €ì¥</button>

                <h4 style="margin-top:30px; border-top:1px solid #eee; padding-top:20px;">ë§¤ì¥ QR ì½”ë“œ</h4>
                <p style="color:#666; font-size:14px;">ê³ ê°ì´ ìŠ¤ìº”í•˜ì—¬ ë§¤ì¥ ì •ë³´ ë° ë©”ë‰´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” QRì½”ë“œì…ë‹ˆë‹¤.</p>
                <div id="provider-qr-code" style="margin: 15px auto; width: 180px; height: 180px; background: #f1f5f9; display: flex; align-items: center; justify-content: center; border-radius: 12px; padding: 15px; box-sizing: border-box;">
                    <span style="color: #999;">Loading QR...</span>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, doc, deleteDoc, onSnapshot, setDoc, updateDoc, getDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyAonpP6itJ9_vMlAQm-0oC-fqmhlYMReE4", authDomain: "imake-master.firebaseapp.com", projectId: "imake-master", storageBucket: "imake-master.firebasestorage.app", messagingSenderId: "612892096078", appId: "1:612892096078:web:5a573c1a0dceb525eaf51f" };
        const app = initializeApp(firebaseConfig);
        
        window.auth = getAuth(app); window.db = getFirestore(app); window.provider = new GoogleAuthProvider();
        window.signInWithPopup = signInWithPopup; window.signOut = signOut; window.onAuthStateChanged = onAuthStateChanged;
        window.collection = collection; window.doc = doc; window.setDoc = setDoc; window.deleteDoc = deleteDoc; window.onSnapshot = onSnapshot; window.updateDoc = updateDoc; window.getDoc = getDoc; window.query = query; window.where = where; window.getDocs = getDocs;
    </script>
    <script src="pscript.js" defer></script>
</body>
</html>